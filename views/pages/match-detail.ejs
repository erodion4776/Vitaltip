<% layout('layouts/main') %>

<!-- Breadcrumb -->
<section class="py-3" style="background: rgba(255,255,255,0.02); border-bottom: 1px solid rgba(255,255,255,0.05);">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/" class="text-muted text-decoration-none">Home</a></li>
                <li class="breadcrumb-item text-muted" aria-current="page">Prediction</li>
                <li class="breadcrumb-item active text-primary" aria-current="page"><%= match.home_team %> vs <%= match.away_team %></li>
            </ol>
        </nav>
    </div>
</section>

<!-- Match Header -->
<section class="match-header py-5 position-relative overflow-hidden">
    <!-- Background Glow Effect -->
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%; height: 100%; background: radial-gradient(circle at center, rgba(59, 130, 246, 0.15) 0%, transparent 70%); z-index: -1;"></div>

    <div class="container">
        <div class="text-center mb-5">
            <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 px-3 py-2 mb-3 rounded-pill">
                <i class="bi bi-trophy me-1"></i><%= match.league %>
            </span>
            <p class="mb-0 text-muted small text-uppercase fw-bold fw-spacing-1">
                <i class="bi bi-calendar me-1"></i>
                <%= helpers.formatDate(match.match_date, 'dddd, MMM DD') %>
                <span class="mx-2">â€¢</span>
                <%= helpers.formatDate(match.match_date, 'HH:mm') %>
            </p>
        </div>
        
        <div class="row align-items-center justify-content-center">
            <!-- Home Team -->
            <div class="col-4 col-md-4 text-center">
                <div class="position-relative mb-3 d-inline-block">
                    <% if (match.home_logo) { %>
                        <img src="<%= match.home_logo %>" alt="<%= match.home_team %>" class="team-logo-lg" style="width: 80px; height: 80px; object-fit: contain; filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));">
                    <% } else { %>
                        <div class="team-logo-lg-placeholder rounded-circle bg-dark border border-secondary border-opacity-25 d-flex align-items-center justify-content-center mx-auto" style="width: 80px; height: 80px;">
                            <i class="bi bi-shield-fill fs-2 text-muted"></i>
                        </div>
                    <% } %>
                </div>
                <h3 class="fw-bold text-white mb-2 fs-4"><%= match.home_team %></h3>
                <div class="badge bg-dark border border-secondary border-opacity-25 text-muted px-2 py-1 fw-normal">
                    Form: <%= match.home_form %>
                </div>
            </div>
            
            <!-- VS -->
            <div class="col-4 col-md-2 text-center py-3">
                <% if (match.status === 'finished' && match.result_score) { %>
                    <div class="score-display">
                        <span class="display-4 fw-bold text-white"><%= match.result_score %></span>
                        <span class="badge bg-<%= match.bet_status === 'won' ? 'success' : 'danger' %> mt-2">
                            <%= match.bet_status.toUpperCase() %>
                        </span>
                    </div>
                <% } else { %>
                    <div class="vs-circle rounded-circle d-flex align-items-center justify-content-center mx-auto fw-bold fs-5" 
                         style="width: 50px; height: 50px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: rgba(255,255,255,0.5);">
                        VS
                    </div>
                <% } %>
            </div>
            
            <!-- Away Team -->
            <div class="col-4 col-md-4 text-center">
                <div class="position-relative mb-3 d-inline-block">
                    <% if (match.away_logo) { %>
                        <img src="<%= match.away_logo %>" alt="<%= match.away_team %>" class="team-logo-lg" style="width: 80px; height: 80px; object-fit: contain; filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));">
                    <% } else { %>
                        <div class="team-logo-lg-placeholder rounded-circle bg-dark border border-secondary border-opacity-25 d-flex align-items-center justify-content-center mx-auto" style="width: 80px; height: 80px;">
                            <i class="bi bi-shield-fill fs-2 text-muted"></i>
                        </div>
                    <% } %>
                </div>
                <h3 class="fw-bold text-white mb-2 fs-4"><%= match.away_team %></h3>
                <div class="badge bg-dark border border-secondary border-opacity-25 text-muted px-2 py-1 fw-normal">
                    Form: <%= match.away_form %>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<section class="py-5">
    <div class="container">
        <div class="row g-4">
            <!-- Main Column -->
            <div class="col-lg-8">
                <!-- Prediction Card -->
                <div class="card border-0 shadow-lg mb-4" style="background: #1e293b; border: 1px solid rgba(255,255,255,0.05);">
                    <div class="card-header border-0 py-3" style="background: rgba(59, 130, 246, 0.1); border-bottom: 1px solid rgba(59, 130, 246, 0.1) !important;">
                        <h5 class="mb-0 text-primary fw-bold">
                            <i class="bi bi-bullseye me-2"></i>Official Prediction
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-md-8 mb-3 mb-md-0">
                                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.75rem; letter-spacing: 1px;">Recommended Bet</small>
                                <h2 class="text-white fw-bold mb-2 mt-1"><%= match.prediction %></h2>
                                <% if (match.odds) { %>
                                    <div class="d-inline-flex align-items-center bg-dark rounded px-2 py-1 border border-secondary border-opacity-25">
                                        <span class="text-muted small me-2">Odds:</span>
                                        <strong class="text-white"><%= match.odds %></strong>
                                    </div>
                                <% } %>
                            </div>
                            <div class="col-md-4 text-md-end">
                                <div class="confidence-meter d-inline-block text-center p-3 rounded bg-dark border border-secondary border-opacity-10">
                                    <div class="position-relative d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; margin: 0 auto;">
                                        <svg viewBox="0 0 36 36" class="circular-chart" style="width: 100%; height: 100%; transform: rotate(-90deg);">
                                            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#334155" stroke-width="3" />
                                            <path class="circle" stroke-dasharray="<%= match.confidence %>, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="<%= confidenceInfo.class === 'success' ? '#10b981' : (confidenceInfo.class === 'warning' ? '#f59e0b' : '#3b82f6') %>" stroke-width="3" />
                                        </svg>
                                        <span class="position-absolute fw-bold text-white"><%= match.confidence %>%</span>
                                    </div>
                                    <small class="d-block mt-2 text-<%= confidenceInfo.class %> fw-bold" style="font-size: 0.7rem;">
                                        <%= confidenceInfo.label %>
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <% if (match.affiliate_link) { %>
                            <div class="mt-4 pt-4 border-top border-secondary border-opacity-25">
                                <a href="<%= match.affiliate_link %>" 
                                   target="_blank" 
                                   rel="noopener noreferrer"
                                   class="btn btn-success w-100 fw-bold py-3 shadow-lg hover-lift">
                                    <i class="bi bi-cash-coin me-2"></i>Bet This Tip Now
                                </a>
                            </div>
                        <% } %>
                    </div>
                </div>
                
                <!-- Analysis Card -->
                <div class="card border-0 shadow-lg mb-4" style="background: #1e293b; border: 1px solid rgba(255,255,255,0.05);">
                    <div class="card-header bg-transparent py-3 border-bottom border-secondary border-opacity-25">
                        <h5 class="mb-0 text-white">
                            <i class="bi bi-file-text me-2 text-primary"></i>Match Analysis
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <% if (match.analysis) { %>
                            <div class="analysis-content text-gray-300" style="color: #cbd5e1; line-height: 1.7;">
                                <%- match.analysis.replace(/\n/g, '<br>') %>
                            </div>
                        <% } else { %>
                            <p class="text-muted mb-0 fst-italic">Detailed analysis will be added soon.</p>
                        <% } %>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Match Info Card -->
                <div class="card border-0 shadow-lg mb-4" style="background: #1e293b; border: 1px solid rgba(255,255,255,0.05);">
                    <div class="card-header bg-transparent py-3 border-bottom border-secondary border-opacity-25">
                        <h6 class="mb-0 text-white">
                            <i class="bi bi-info-circle me-2 text-primary"></i>Match Info
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush bg-transparent">
                            <li class="list-group-item bg-transparent border-bottom border-secondary border-opacity-25 d-flex justify-content-between py-3 text-gray-300">
                                <span class="text-muted">League</span>
                                <strong class="text-white"><%= match.league %></strong>
                            </li>
                            <li class="list-group-item bg-transparent border-bottom border-secondary border-opacity-25 d-flex justify-content-between py-3 text-gray-300">
                                <span class="text-muted">Date</span>
                                <strong class="text-white"><%= helpers.formatDate(match.match_date, 'MMM DD, YYYY') %></strong>
                            </li>
                            <li class="list-group-item bg-transparent border-bottom border-secondary border-opacity-25 d-flex justify-content-between py-3 text-gray-300">
                                <span class="text-muted">Time</span>
                                <strong class="text-white"><%= helpers.formatDate(match.match_date, 'HH:mm') %></strong>
                            </li>
                            <li class="list-group-item bg-transparent d-flex justify-content-between py-3 text-gray-300">
                                <span class="text-muted">Status</span>
                                <span class="badge bg-<%= match.status === 'upcoming' ? 'primary' : 'secondary' %> bg-opacity-20 text-<%= match.status === 'upcoming' ? 'primary' : 'light' %>">
                                    <%= match.status.charAt(0).toUpperCase() + match.status.slice(1) %>
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- Related Matches -->
                <% if (relatedMatches && relatedMatches.length > 0) { %>
                    <div class="card border-0 shadow-lg" style="background: #1e293b; border: 1px solid rgba(255,255,255,0.05);">
                        <div class="card-header bg-transparent py-3 border-bottom border-secondary border-opacity-25">
                            <h6 class="mb-0 text-white">
                                <i class="bi bi-collection me-2 text-primary"></i>More Predictions
                            </h6>
                        </div>
                        <div class="card-body p-0">
                            <ul class="list-group list-group-flush bg-transparent">
                                <% relatedMatches.forEach(related => { %>
                                    <li class="list-group-item bg-transparent border-bottom border-secondary border-opacity-25 hover-bg-dark">
                                        <a href="/prediction/<%= related.slug %>" class="text-decoration-none d-block py-2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <small class="text-primary d-block mb-1" style="font-size: 0.7rem;">
                                                        <%= helpers.formatDate(related.match_date, 'MMM DD, HH:mm') %>
                                                    </small>
                                                    <span class="text-white fw-semibold" style="font-size: 0.9rem;">
                                                        <%= related.home_team %> vs <%= related.away_team %>
                                                    </span>
                                                </div>
                                                <i class="bi bi-chevron-right text-muted small"></i>
                                            </div>
                                        </a>
                                    </li>
                                <% }); %>
                            </ul>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</section>
