<% layout('layouts/main') %>

<!-- Breadcrumb -->
<section class="py-2 py-md-3" style="background: rgba(255,255,255,0.02); border-bottom: 1px solid rgba(255,255,255,0.05);">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0 small">
                <li class="breadcrumb-item">
                    <a href="/" class="text-muted text-decoration-none">
                        <i class="bi bi-house-fill me-1"></i>Home
                    </a>
                </li>
                <li class="breadcrumb-item active text-primary" aria-current="page">
                    <%= match.home_team %> vs <%= match.away_team %>
                </li>
            </ol>
        </nav>
    </div>
</section>

<!-- Match Header -->
<section class="match-header py-4 py-md-5 position-relative overflow-hidden">
    <!-- Background Glow -->
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%; height: 100%; background: radial-gradient(circle at center, rgba(59, 130, 246, 0.15) 0%, transparent 70%); z-index: 0;"></div>

    <div class="container position-relative" style="z-index: 1;">
        <!-- League & Date -->
        <div class="text-center mb-4">
            <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 px-3 py-2 mb-2 rounded-pill">
                <i class="bi bi-trophy me-1"></i><%= match.league %>
            </span>
            <p class="mb-0 text-muted small text-uppercase fw-bold">
                <i class="bi bi-calendar me-1"></i>
                <%= helpers.formatDate(match.match_date, 'ddd, MMM DD') %>
                <span class="mx-2">â€¢</span>
                <i class="bi bi-clock me-1"></i>
                <%= helpers.formatDate(match.match_date, 'HH:mm') %>
            </p>
        </div>
        
        <!-- Teams -->
        <div class="row align-items-center justify-content-center g-3">
            <!-- Home Team -->
            <div class="col-5 col-md-4 text-center">
                <% if (match.home_logo) { %>
                    <img src="<%= match.home_logo %>" 
                         alt="<%= match.home_team %>" 
                         class="mb-3"
                         style="width: 60px; height: 60px; object-fit: contain; filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));"
                         loading="eager">
                <% } else { %>
                    <div class="rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" 
                         style="width: 60px; height: 60px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">
                        <i class="bi bi-shield-fill fs-2 text-muted"></i>
                    </div>
                <% } %>
                <h3 class="fw-bold text-white mb-2 fs-5"><%= match.home_team %></h3>
                <span class="badge bg-dark border border-secondary border-opacity-25 text-muted">
                    <%= match.home_form %>
                </span>
            </div>
            
            <!-- VS / Score -->
            <div class="col-2 text-center">
                <% if (match.status === 'finished' && match.result_score) { %>
                    <div class="score-display">
                        <span class="display-5 fw-bold text-white d-block"><%= match.result_score %></span>
                        <span class="badge bg-<%= match.bet_status === 'won' ? 'success' : 'danger' %> mt-2">
                            <%= match.bet_status.toUpperCase() %>
                        </span>
                    </div>
                <% } else { %>
                    <div class="rounded-circle d-flex align-items-center justify-content-center mx-auto fw-bold" 
                         style="width: 45px; height: 45px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: rgba(255,255,255,0.5);">
                        VS
                    </div>
                <% } %>
            </div>
            
            <!-- Away Team -->
            <div class="col-5 col-md-4 text-center">
                <% if (match.away_logo) { %>
                    <img src="<%= match.away_logo %>" 
                         alt="<%= match.away_team %>" 
                         class="mb-3"
                         style="width: 60px; height: 60px; object-fit: contain; filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));"
                         loading="eager">
                <% } else { %>
                    <div class="rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" 
                         style="width: 60px; height: 60px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">
                        <i class="bi bi-shield-fill fs-2 text-muted"></i>
                    </div>
                <% } %>
                <h3 class="fw-bold text-white mb-2 fs-5"><%= match.away_team %></h3>
                <span class="badge bg-dark border border-secondary border-opacity-25 text-muted">
                    <%= match.away_form %>
                </span>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<section class="py-4">
    <div class="container">
        <div class="row g-4">
            <!-- Main Column -->
            <div class="col-lg-8">
                <!-- Prediction Card -->
                <div class="card border-0 shadow-lg mb-4">
                    <div class="card-header border-0 py-3" style="background: rgba(59, 130, 246, 0.1);">
                        <h5 class="mb-0 text-primary fw-bold">
                            <i class="bi bi-bullseye me-2"></i>Our Prediction
                        </h5>
                    </div>
                    <div class="card-body p-3 p-md-4">
                        <div class="row align-items-center">
                            <div class="col-md-8 mb-3 mb-md-0">
                                <small class="text-muted text-uppercase fw-bold d-block mb-2" style="font-size: 0.7rem; letter-spacing: 1px;">
                                    Recommended Bet
                                </small>
                                <h2 class="text-white fw-bold mb-2"><%= match.prediction %></h2>
                                <% if (match.odds) { %>
                                    <div class="d-inline-flex align-items-center bg-dark rounded px-3 py-2 border border-secondary border-opacity-25">
                                        <span class="text-muted small me-2">Odds:</span>
                                        <strong class="text-white fs-5"><%= match.odds %></strong>
                                    </div>
                                <% } %>
                            </div>
                            <div class="col-md-4 text-center text-md-end">
                                <% const conf = helpers.getConfidenceLabel(match.confidence); %>
                                <div class="d-inline-block">
                                    <div class="position-relative d-flex align-items-center justify-content-center mx-auto" 
                                         style="width: 70px; height: 70px;">
                                        <svg viewBox="0 0 36 36" style="width: 100%; height: 100%; transform: rotate(-90deg);">
                                            <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" 
                                                  fill="none" 
                                                  stroke="#334155" 
                                                  stroke-width="3" />
                                            <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" 
                                                  fill="none" 
                                                  stroke="<%= conf.class === 'success' ? '#10b981' : (conf.class === 'warning' ? '#f59e0b' : '#3b82f6') %>" 
                                                  stroke-width="3" 
                                                  stroke-dasharray="<%= match.confidence %>, 100" 
                                                  style="transition: stroke-dasharray 1s ease-in-out;"/>
                                        </svg>
                                        <span class="position-absolute fw-bold text-white fs-4"><%= match.confidence %>%</span>
                                    </div>
                                    <small class="d-block mt-2 text-<%= conf.class %> fw-bold">
                                        <%= conf.label %> Confidence
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <% if (match.affiliate_link) { %>
                            <div class="mt-4 pt-4 border-top border-secondary border-opacity-25">
                                <a href="<%= match.affiliate_link %>" 
                                   target="_blank" 
                                   rel="noopener noreferrer"
                                   class="btn btn-success w-100 fw-bold py-3 shadow-lg">
                                    <i class="bi bi-cash-coin me-2"></i>Place This Bet Now
                                </a>
                            </div>
                        <% } %>
                    </div>
                </div>
                
                <!-- Analysis Card -->
                <div class="card border-0 shadow-lg mb-4">
                    <div class="card-header bg-transparent py-3">
                        <h5 class="mb-0 text-white">
                            <i class="bi bi-file-text me-2 text-primary"></i>Expert Analysis
                        </h5>
                    </div>
                    <div class="card-body p-3 p-md-4">
                        <% if (match.analysis) { %>
                            <div class="analysis-content" style="color: #cbd5e1; line-height: 1.8;">
                                <%- match.analysis.replace(/\n/g, '<br>') %>
                            </div>
                        <% } else { %>
                            <div class="text-center py-4">
                                <i class="bi bi-hourglass-split fs-1 text-muted opacity-25"></i>
                                <p class="text-muted mt-3 mb-0">Detailed analysis coming soon...</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Match Info Card -->
                <div class="card border-0 shadow-lg mb-4">
                    <div class="card-header bg-transparent py-3">
                        <h6 class="mb-0 text-white">
                            <i class="bi bi-info-circle me-2 text-primary"></i>Match Details
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush bg-transparent">
                            <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center py-3">
                                <span class="text-muted"><i class="bi bi-trophy me-2"></i>League</span>
                                <strong class="text-white text-end"><%= match.league %></strong>
                            </li>
                            <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center py-3">
                                <span class="text-muted"><i class="bi bi-calendar me-2"></i>Date</span>
                                <strong class="text-white"><%= helpers.formatDate(match.match_date, 'MMM DD, YYYY') %></strong>
                            </li>
                            <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center py-3">
                                <span class="text-muted"><i class="bi bi-clock me-2"></i>Time</span>
                                <strong class="text-white"><%= helpers.formatDate(match.match_date, 'HH:mm') %></strong>
                            </li>
                            <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center py-3">
                                <span class="text-muted"><i class="bi bi-activity me-2"></i>Status</span>
                                <span class="badge bg-<%= match.status === 'upcoming' ? 'primary' : 'secondary' %> bg-opacity-20 text-<%= match.status === 'upcoming' ? 'primary' : 'light' %>">
                                    <%= match.status.charAt(0).toUpperCase() + match.status.slice(1) %>
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- Related Matches -->
                <% if (relatedMatches && relatedMatches.length > 0) { %>
                    <div class="card border-0 shadow-lg">
                        <div class="card-header bg-transparent py-3">
                            <h6 class="mb-0 text-white">
                                <i class="bi bi-collection me-2 text-primary"></i>More Predictions
                            </h6>
                        </div>
                        <div class="card-body p-0">
                            <ul class="list-group list-group-flush bg-transparent">
                                <% relatedMatches.forEach(related => { %>
                                    <li class="list-group-item bg-transparent border-bottom border-secondary border-opacity-25 p-0">
                                        <a href="/prediction/<%= related.slug %>" class="text-decoration-none d-block p-3 hover-bg-light" style="transition: background 0.2s;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="flex-grow-1">
                                                    <small class="text-primary d-block mb-1" style="font-size: 0.7rem;">
                                                        <%= helpers.formatDate(related.match_date, 'MMM DD, HH:mm') %>
                                                    </small>
                                                    <span class="text-white fw-semibold d-block" style="font-size: 0.9rem;">
                                                        <%= related.home_team %>
                                                    </span>
                                                    <span class="text-muted small">vs <%= related.away_team %></span>
                                                </div>
                                                <i class="bi bi-chevron-right text-muted"></i>
                                            </div>
                                        </a>
                                    </li>
                                <% }); %>
                            </ul>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
        
        <!-- Back Button (Mobile) -->
        <div class="mt-4 d-md-none">
            <a href="/" class="btn btn-outline-light w-100">
                <i class="bi bi-arrow-left me-2"></i>Back to Predictions
            </a>
        </div>
    </div>
</section>
